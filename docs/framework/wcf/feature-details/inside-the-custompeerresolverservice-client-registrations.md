---
title: CustomPeerResolverService 内部:クライアント登録
ms.date: 03/30/2017
ms.assetid: 40236953-a916-4236-84a6-928859e1331a
ms.openlocfilehash: a905e5d1e467f32575eb38451d66392be25a0759
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "96265883"
---
# <a name="inside-the-custompeerresolverservice-client-registrations"></a><span data-ttu-id="4e2db-102">CustomPeerResolverService 内部:クライアント登録</span><span class="sxs-lookup"><span data-stu-id="4e2db-102">Inside the CustomPeerResolverService: Client Registrations</span></span>

<span data-ttu-id="4e2db-103">メッシュ内の各ノードは、`Register` 関数を介してエンドポイント情報をリゾルバー サービスに公開します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-103">Each node in the mesh publishes its endpoint information to the resolver service through the `Register` function.</span></span> <span data-ttu-id="4e2db-104">リゾルバー サービスは、登録レコードとしてこの情報を保存します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-104">The resolver service stores this information as a registration record.</span></span> <span data-ttu-id="4e2db-105">このレコードには、ノードの一意の識別子 (RegistrationID) およびエンドポイント情報 \`(PeerNodeAddress) が格納されます。</span><span class="sxs-lookup"><span data-stu-id="4e2db-105">This record contains a unique identifier (RegistrationID) and endpoint information (PeerNodeAddress) for the node.</span></span>  
  
## <a name="stale-records-and-expiration-time"></a><span data-ttu-id="4e2db-106">古くなったレコードと有効期限</span><span class="sxs-lookup"><span data-stu-id="4e2db-106">Stale Records and Expiration Time</span></span>  

 <span data-ttu-id="4e2db-107">ノードがメッシュからの離脱時に `Unregister` 関数を呼び出し、それによってリゾルバー サービスで登録エントリが削除されるのが理想的ですが、</span><span class="sxs-lookup"><span data-stu-id="4e2db-107">Ideally, when a node leaves the mesh, it will call the `Unregister` function, which causes the resolver service to remove the registration entry.</span></span> <span data-ttu-id="4e2db-108">`Unregister` を呼び出す前に、ノードがシャットダウンしたりアクセスできなくなったりするために、古い登録レコードが残ることがあります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-108">Sometimes, nodes shut down or become inaccessible before calling `Unregister`, leaving behind a stale registration record.</span></span>  
  
 <span data-ttu-id="4e2db-109">リゾルバー サービス内の古くなったレコードは、接続障害の原因となる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-109">Stale records in your resolver service can cause failed connections.</span></span> <span data-ttu-id="4e2db-110">メッシュへの接続時に、ノードがリゾルバー サービスから古い接続情報を受け取った場合、メッシュへの参加に時間がかかることがあります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-110">If a node trying to connect to a mesh receives stale connection information from the resolver service, it can take longer to successfully join the mesh.</span></span> <span data-ttu-id="4e2db-111">古いレコードはメモリも消費します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-111">Stale records also take up memory.</span></span> <span data-ttu-id="4e2db-112">効率的なクリーンアップ処理がなければ、登録の保存に使用したキャッシュがオーバーフローしてリゾルバー サービスがクラッシュする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-112">Without an efficient clean up process, the cache used to store registrations could eventually overflow and crash the resolver service.</span></span>  
  
 <span data-ttu-id="4e2db-113"><xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> は、各レコードを有効期限 (DateTime) でマークし、レコードの一部としてその情報を保存します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-113">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> marks each record with an expiration time (DateTime), and stores that information as part of the record.</span></span> <span data-ttu-id="4e2db-114">サービスは、有効期限を使用してレコードを識別します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-114">The service uses the expiration time to identify stale records.</span></span> <span data-ttu-id="4e2db-115">カスタム実装でも同様な処理が必要です。</span><span class="sxs-lookup"><span data-stu-id="4e2db-115">Custom implementations should do something similar.</span></span>  
  
## <a name="refreshinterval-and-cleanupinterval"></a><span data-ttu-id="4e2db-116">RefreshInterval および CleanupInterval</span><span class="sxs-lookup"><span data-stu-id="4e2db-116">RefreshInterval and CleanupInterval</span></span>  

 <span data-ttu-id="4e2db-117">`RefreshInterval` の <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> プロパティは、サービスの登録ルックアップ テーブルで登録レコードが有効である期間を定義します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-117">The `RefreshInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> defines how long registration records remain valid in the service's registration lookup table.</span></span> <span data-ttu-id="4e2db-118">特定のレコードについて、このプロパティで指定された時間が経過すると、そのレコードは古くなり、削除対象としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="4e2db-118">When the amount of time supplied to this property has passed for a given record, that record becomes stale and is marked for deletion.</span></span>  
  
 <span data-ttu-id="4e2db-119">`CleanupInterval` の <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> プロパティは、古くなったレコードの検索と削除の頻度をサービスに指示します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-119">The `CleanupInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> tells the service how often to search for and delete stale registration records.</span></span> <span data-ttu-id="4e2db-120">`CleanupInterval` は、サービスに設定されている `RefreshInterval` 以上の時間に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-120">The `CleanupInterval` should be set to a time greater than or equal to the `RefreshInterval` set on the service.</span></span>  
  
 <span data-ttu-id="4e2db-121">独自のリゾルバー サービスを実装するためには、古い登録レコードを削除するメンテナンス関数を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-121">To implement your own resolver service, you need to write a maintenance function to remove stale registration records.</span></span> <span data-ttu-id="4e2db-122">これにはいくつかの方法があります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-122">There are several ways to do this:</span></span>  
  
- <span data-ttu-id="4e2db-123">**定期的なメンテナンス**: タイマーが定期的にオフになるように設定し、データストアを使用して古いレコードを削除します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-123">**Periodic maintenance**: Set a timer to go off periodically, and go through your data store to delete old records.</span></span> <span data-ttu-id="4e2db-124"><xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> では、この方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-124">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> uses this approach.</span></span>  
  
- <span data-ttu-id="4e2db-125">**パッシブな削除**: 古いレコードを定期的に検索するのではなく、サービスが既に別の機能を実行している場合は、古いレコードを特定して削除できます。</span><span class="sxs-lookup"><span data-stu-id="4e2db-125">**Passive deletion**: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function.</span></span> <span data-ttu-id="4e2db-126">この方法では、リゾルバー クライアントからの要求に対する応答時間が遅くなる可能性がありますが、タイマーの必要がなくなるほか、一部のノードが `Unregister` を呼び出さずに離脱することが予想される場合には効果的です。</span><span class="sxs-lookup"><span data-stu-id="4e2db-126">This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling `Unregister`.</span></span>  
  
## <a name="registrationlifetime-and-refresh"></a><span data-ttu-id="4e2db-127">RegistrationLifetime および Refresh</span><span class="sxs-lookup"><span data-stu-id="4e2db-127">RegistrationLifetime and Refresh</span></span>  

 <span data-ttu-id="4e2db-128">リゾルバー サービスに登録されると、ノードはサービスから <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> オブジェクトを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-128">When a node registers with a resolver service, it receives a <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> object from the service.</span></span> <span data-ttu-id="4e2db-129">このオブジェクトには、`RegistrationLifetime` プロパティが含まれます。このプロパティは、登録の期限が切れてリゾルバー サービスによって削除されるまでに、どれだけの時間があるかを示します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-129">This object has a `RegistrationLifetime` property which indicates to the node how much time it has before the registration expires and is removed by the resolver service.</span></span> <span data-ttu-id="4e2db-130">たとえば、`RegistrationLifetime` が 2 分である場合、レコードが古くならず、削除されないようにするためには、ノードは 2 分以内に `Refresh` を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e2db-130">If, for example, the `RegistrationLifetime` is 2 minutes, the node needs to call `Refresh` in under 2 minutes to ensure the record stays fresh and is not deleted.</span></span> <span data-ttu-id="4e2db-131">リゾルバー サービスは `Refresh` 要求を受け取ると、レコードを検索し、有効期限をリセットします。</span><span class="sxs-lookup"><span data-stu-id="4e2db-131">When the resolver service receives a `Refresh` request, it looks up the record and resets the expiration time.</span></span> <span data-ttu-id="4e2db-132">Refresh は、<xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> プロパティのある `RegistrationLifetime` オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="4e2db-132">Refresh returns a <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> object with a `RegistrationLifetime` property.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4e2db-133">関連項目</span><span class="sxs-lookup"><span data-stu-id="4e2db-133">See also</span></span>

- [<span data-ttu-id="4e2db-134">ピア リゾルバー</span><span class="sxs-lookup"><span data-stu-id="4e2db-134">Peer Resolvers</span></span>](peer-resolvers.md)
